<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Sample Chat</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" type='text/css' href="css/general.css">
  <link rel="stylesheet" type='text/css' href="css/styles.css">
</head>
<body>
  <div class="container my-3 py-3" id="main-container">

    <div id="userFormArea">
      <form id="userForm">
        <div class="form-group mb-2">
          <label for="">Enter Username</label>
          <input class="form-control" id="username" type="text" required/>
        </div>
        <input type="submit" class="btn btn-sm btn-custom-primary" value="Log in">

      </form>
    </div>

    <div class="row" id="messageArea" hidden>
      <div class="col col-3">
        <div>
          <p class="fs-1_2em">Users</p>

          <!-- user list  -->
          <div id="users"></div>

        </div>
      </div>

      <div class="col">
        <div>

          <p class="fs-1_2em mb-2">Chat</p>

          <!-- chat messages -->
          <div id="chat"></div>

          <form id="messageForm">
            <div class="form-group mb-2">
              <textarea class="form-control" rows="4" id="message" placeholder="Enter Message"></textarea>
            </div>
            <input type="submit" class="btn btn-sm btn-custom-primary" value="Submit">
          </form>

        </div>

      </div>
    </div>

  </div>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript">
    $(()=>{
      let
        socket = io.connect(),
        username = $(`#username`)
        message = $(`#message`),
        chat = $(`#chat`)

      $(`#messageForm`).submit(function(e){
        e.preventDefault();
        socket.emit('mess:send', message.val())
        message.val('')
      })

      socket.on('mess:new', function(data){
        chat.append(`<p class="fs-09em mb-2"><span class="fw-600">${data.user} : </span>${data.msg}</p>`)
      })

      $(`#userForm`).submit(function(e){
        e.preventDefault();
        socket.emit('user:new', username.val())

        $(`#userFormArea`).attr('hidden','hidden')
        $(`#messageArea`).removeAttr('hidden')
      })

      socket.on('user:get', function(data){
        $('#users').html('')
        data.forEach((user)=>{
          $('#users').append(`<p class="fs-09em mb-2">${user}</p>`)
        })
      })

    })
  </script>
</body>
</html>
